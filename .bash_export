# ~/.bash_exports
# Экспорт переменных окружения и глобальных настроек

# --- Пути (PATH) ---
# Добавить пользовательский каталог bin в PATH для запуска локальных скриптов
[ -d "$HOME/bin" ] && [[ ":$PATH:" != *":$HOME/bin:"* ]] && PATH="$HOME/bin:$PATH"
# Добавить локальный каталог .local/bin (стандарт для pip)
[ -d "$HOME/.local/bin" ] && [[ ":$PATH:" != *":$HOME/.local/bin:"* ]] && PATH="$HOME/.local/bin:$PATH"

# --- Настройки истории команд ---
HISTSIZE=$((1024 * 1024))               # Очень большой размер истории в памяти
HISTFILESIZE=$HISTSIZE                  # Очень большой размер файла истории
HISTTIMEFORMAT='%F %T '                 # Добавлять временную метку к каждой команде
HISTCONTROL=ignoreboth                  # Не сохранять дубликаты и команды, начинающиеся с пробела
HISTIGNORE="ls:bg:fg:history"           # Не сохранять эти команды в истории
shopt -s histappend                     # Добавлять в файл истории, а не перезаписывать его

# --- Редакторы и пейджеры ---
export EDITOR='vim'
export PAGER='less'
export LESS='-R'

# --- Настройки локали ---
export LANG='ru_RU.UTF-8'
export LC_ALL='ru_RU.UTF-8'

# --- Настройки цветов ---
export CLICOLOR=1
export LS_COLORS='di=1;34:ln=35:so=32:pi=33:ex=31:bd=34;46:cd=34;43:su=30;41:sg=30;46:tw=30;42:ow=30;43'

# --- Инициализация менеджеров версий ---
# Инициализация rbenv для Ruby
type -f rbenv >/dev/null 2>&1 && eval "$(rbenv init -)"
# Инициализация pyenv для Python
type -f pyenv >/dev/null 2>&1 && eval "$(pyenv init -)"

# --- SSH Agent ---
# Автоматический запуск ssh-agent и добавление ключа
[ -f ~/.ssh/id_ed25519 ] && [ -f ~/.ssh/id_ed25519.pub ] && {
    export SSH_AUTH_SOCK=~/.ssh/agent
    # Запустить агент, если он еще не запущен
    pgrep -f $SSH_AUTH_SOCK >/dev/null || {
        rm -f $SSH_AUTH_SOCK
        ssh-agent -a $SSH_AUTH_SOCK &>/dev/null
    }
    # Добавить ключ, если он еще не добавлен
    ssh-add -L | grep -q "$(cut -f1,2 -d' ' ~/.ssh/id_ed25519.pub)" || ssh-add
}

# --- Docker ---
export DOCKER_HOST=unix:///var/run/docker.sock

